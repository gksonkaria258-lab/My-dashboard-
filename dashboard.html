<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lead CRM</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>

body{
margin:0;
font-family:system-ui;
background:#f1f5f9;
}

.sidebar{
position:fixed;
width:220px;
height:100%;
background:#0f172a;
color:white;
padding:20px;
}

.sidebar h2{
color:#38bdf8;
}

.sidebar button{
width:100%;
padding:10px;
margin-top:10px;
border:none;
border-radius:8px;
background:#ef4444;
color:white;
}

.main{
margin-left:240px;
padding:20px;
}

.cards{
display:flex;
gap:10px;
flex-wrap:wrap;
}

.stat{
background:white;
padding:15px;
border-radius:10px;
flex:1;
min-width:120px;
box-shadow:0 5px 15px rgba(0,0,0,0.1);
}

.card{
background:white;
padding:15px;
border-radius:10px;
margin-top:15px;
box-shadow:0 5px 15px rgba(0,0,0,0.1);
}

input{
padding:10px;
margin:5px;
border:1px solid #ddd;
border-radius:8px;
}

button{
padding:8px;
border:none;
border-radius:6px;
cursor:pointer;
}

.add{
background:#3b82f6;
color:white;
}

.call{
background:green;
color:white;
}

.whatsapp{
background:#22c55e;
color:white;
}

.delete{
background:red;
color:white;
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
padding:10px;
border-bottom:1px solid #ddd;
}

</style>

</head>
<body>

<div class="sidebar">

<h2>Lead CRM</h2>

<button onclick="logout()">Logout</button>

</div>


<div class="main">

<div class="cards">

<div class="stat">
Total Leads<br>
<b id="total">0</b>
</div>

<div class="stat">
Today Leads<br>
<b id="today">0</b>
</div>

</div>


<div class="card">

<input id="search" placeholder="Search..." onkeyup="loadLeads()">

<input id="name" placeholder="Name">
<input id="phone" placeholder="Phone">
<input id="status" placeholder="Status">

<button class="add" onclick="addLead()">Add Lead</button>

</div>


<div class="card">

<table>

<thead>
<tr>
<th>Name</th>
<th>Phone</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>

<tbody id="list"></tbody>

</table>

</div>

</div>


<script>

const supabaseClient = supabase.createClient(
"https://yqvnpuzketsjfbjqfnfb.supabase.co",
"sb_publishable_tK8B2cY6JN-uiHxWM87Tmw_B8XQJlAs"
);


async function logout(){

await supabaseClient.auth.signOut();
window.location.href="/";

}


async function addLead(){

await supabaseClient
.from("leads")
.insert([{

name:name.value,
phone:phone.value,
status:status.value

}]);

loadLeads();

}


async function deleteLead(id){

await supabaseClient
.from("leads")
.delete()
.eq("id",id);

loadLeads();

}


async function loadLeads(){

const search=searchInput.value?.toLowerCase() || "";

const {data}=await supabaseClient
.from("leads")
.select("*")
.order("id",{ascending:false});

let filtered=data.filter(l=>
l.name?.toLowerCase().includes(search) ||
l.phone?.includes(search)
);

total.innerText=data.length;

let todayCount=0;
let today=new Date().toISOString().slice(0,10);

filtered.forEach(l=>{
if(l.created_at?.slice(0,10)==today){
todayCount++;
}
});

today.innerText=todayCount;

let html="";

filtered.forEach(l=>{

let msg="Hello "+l.name+", I am contacting you regarding our opportunity.";

html+=`

<tr>

<td>${l.name}</td>

<td>${l.phone}</td>

<td>${l.status||""}</td>

<td>

<a href="tel:${l.phone}">
<button class="call">Call</button>
</a>

<a href="https://wa.me/91${l.phone}?text=${encodeURIComponent(msg)}" target="_blank">
<button class="whatsapp">WhatsApp</button>
</a>

<button class="delete" onclick="deleteLead(${l.id})">
Delete
</button>

</td>

</tr>

`;

});

list.innerHTML=html;

}

const searchInput=document.getElementById("search");

loadLeads();

</script>

</body>
</html>
